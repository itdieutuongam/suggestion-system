<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Phê duyệt đề nghị thanh toán #{{ request[0] }}</title>
    <style>
        body {font-family: Arial; background:#f5f5f5; padding:30px;}
        .box {max-width:900px; margin:auto; background:white; padding:35px; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.1);}
        h2 {color:#a41017; margin-top:0;}
        .info {background:#f8fbff; padding:18px; border-radius:8px; margin:15px 0; line-height:1.8;}
        label {font-weight:bold; color:#333;}
        select, button {padding:12px; font-size:16px; margin:10px 0;}
        .btn {padding:16px 32px; border:none; border-radius:8px; color:white; cursor:pointer; font-weight:bold; font-size:17px;}
        .approve {background:#4caf50;}
        .reject {background:#f44336;}
        .back {color:#a41017; text-decoration:none; font-size:16px;}
        .bod-notice {background:#fff3e0; padding:18px; border-left:5px solid #ff9800; margin:20px 0; font-weight:bold; border-radius:6px;}
        .payment-method {color:#d32f2f; font-weight:bold; font-size:18px;}
    </style>
</head>
<body>
<div class="box">
    <h2>Phê duyệt đề nghị thanh toán #{{ request[0] }}</h2>
    <div class="info">
        <p><strong>Tiêu đề:</strong> {{ request[1] }}</p>
        <p><strong>Người lập:</strong> {{ request[8] }} ({{ request[3] }})</p>
        <p><strong>Phương thức thanh toán:</strong> <span class="payment-method">{{ request[2] }}</span></p>
        <p><strong>Thành phố:</strong> {{ request[4] }}</p>
        <p><strong>Ngày lập:</strong> {{ request[9] }}</p>
        <p><strong>Tổng chi phí:</strong> 
            <span style="font-size:20px; color:#d32f2f; font-weight:bold;">
                {% if request[12] > 0 %}{{ "{:,.0f}".format(request[12]) }} VND{% else %}—{% endif %}
            </span>
        </p>
        <p><strong>Tệp đính kèm:</strong>
            {% if request[11] %}
                <a href="{{ url_for('uploaded_file', filename=request[11]) }}" target="_blank" style="color:#a41017; font-weight:bold;">Xem tệp đính kèm</a>
            {% else %}Không có{% endif %}
        </p>
    </div>

    <form method="POST">
        {% if is_bod %}
            <div style="background:#e8f5e9; padding:20px; border-radius:8px; margin:25px 0; text-align:center; border:3px solid #4caf50;">
                <strong style="color:#2e7d32; font-size:22px;">BẠN LÀ BOD</strong><br>
                <span style="font-size:17px;">Sau khi bạn duyệt → Đề nghị sẽ được HOÀN TẤT & THANH TOÁN ngay lập tức</span>
            </div>
        {% else %}
            <label>Chọn người phê duyệt tiếp theo <span style="color:red;">*</span>:</label>
            <select name="next_approver" required style="width:100%; padding:14px; font-size:16px;">
                <option value="" disabled selected>-- Chọn người tiếp theo --</option>
                {% for a in approvers %}
                <option value="{{ a }}">{{ a }}
                    {% if a.split(" - ")[0] in ["TRƯƠNG HUỆ KHƯƠNG", "NGUYỄN THỊ HỒNG TUYẾT"] %}
                        (BOD - Duyệt cuối cùng)
                    {% endif %}
                </option>
                {% endfor %}
            </select>
            <div class="bod-notice">
                Nếu bạn chọn BOD → BOD sẽ là người duyệt cuối cùng<br>
                Sau khi BOD duyệt → đề nghị tự động thành "Đã duyệt" và sẵn sàng thanh toán
            </div>
        {% endif %}

        <div style="margin-top:40px; text-align:center;">
            <button type="submit" name="decision" value="approve" class="btn approve">
                {% if is_bod %}DUYỆT HOÀN TẤT & THANH TOÁN (BOD){% else %}Duyệt & Chuyển tiếp{% endif %}
            </button>
            <button type="submit" name="decision" value="reject" class="btn reject">
                Từ chối đề nghị
            </button>
        </div>
    </form>

    <hr style="margin:50px 0;">
    <div style="text-align:center;">
        <a href="{{ url_for('dashboard') }}" class="back">Quay lại trang chủ</a>
    </div>
</div>
</body>
</html>